/*! jPlayerPlaylist for jPlayer 2.9.2 ~ (c) 2009-2014 Happyworm Ltd ~ MIT License */
!function(t,s){jPlayerPlaylist=function(s,i,e){var l=this;this.current=0,this.loop=!1,this.shuffled=!1,this.removing=!1,this.cssSelector=t.extend({},this._cssSelector,s),this.options=t.extend(!0,{keyBindings:{next:{key:221,fn:function(){l.next()}},previous:{key:219,fn:function(){l.previous()}},shuffle:{key:83,fn:function(){l.shuffle()}}},stateClass:{shuffled:"jp-state-shuffled"}},this._options,e),this.playlist=[],this.original=[],this._initPlaylist(i),this.cssSelector.details=this.cssSelector.cssSelectorAncestor+" .jp-details",this.cssSelector.playlist=this.cssSelector.cssSelectorAncestor+" .jp-playlist",this.cssSelector.next=this.cssSelector.cssSelectorAncestor+" .jp-next",this.cssSelector.previous=this.cssSelector.cssSelectorAncestor+" .jp-previous",this.cssSelector.shuffle=this.cssSelector.cssSelectorAncestor+" .jp-shuffle",this.cssSelector.shuffleOff=this.cssSelector.cssSelectorAncestor+" .jp-shuffle-off",this.options.cssSelectorAncestor=this.cssSelector.cssSelectorAncestor,this.options.repeat=function(t){l.loop=t.jPlayer.options.loop},t(this.cssSelector.jPlayer).bind(t.jPlayer.event.ready,function(){l._init()}),t(this.cssSelector.jPlayer).bind(t.jPlayer.event.ended,function(){l.next()}),t(this.cssSelector.jPlayer).bind(t.jPlayer.event.play,function(){t(this).jPlayer("pauseOthers")}),t(this.cssSelector.jPlayer).bind(t.jPlayer.event.resize,function(s){s.jPlayer.options.fullScreen?t(l.cssSelector.details).show():t(l.cssSelector.details).hide()}),t(this.cssSelector.previous).click(function(t){t.preventDefault(),l.previous(),l.blur(this)}),t(this.cssSelector.next).click(function(t){t.preventDefault(),l.next(),l.blur(this)}),t(this.cssSelector.shuffle).click(function(s){s.preventDefault(),l.shuffled&&t(l.cssSelector.jPlayer).jPlayer("option","useStateClassSkin")?l.shuffle(!1):l.shuffle(!0),l.blur(this)}),t(this.cssSelector.shuffleOff).click(function(t){t.preventDefault(),l.shuffle(!1),l.blur(this)}).hide(),this.options.fullScreen||t(this.cssSelector.details).hide(),t(this.cssSelector.playlist+" ul").empty(),this._createItemHandlers(),t(this.cssSelector.jPlayer).jPlayer(this.options)},jPlayerPlaylist.prototype={_cssSelector:{jPlayer:"#jquery_jplayer_1",cssSelectorAncestor:"#jp_container_1"},_options:{playlistOptions:{autoPlay:!1,removePlayed:!1,removeCount:0,shuffleOnLoop:!1,enableRemoveControls:!1,displayTime:"slow",addTime:"fast",removeTime:"fast",shuffleTime:"slow",itemClass:"jp-playlist-item",freeGroupClass:"jp-free-media",freeItemClass:"jp-playlist-item-free",removeItemClass:"jp-playlist-item-remove"}},option:function(t,s){if(void 0===s)return this.options.playlistOptions[t];switch(this.options.playlistOptions[t]=s,t){case"enableRemoveControls":this._updateControls();break;case"itemClass":case"freeGroupClass":case"freeItemClass":case"removeItemClass":this._refresh(!0),this._createItemHandlers()}return this},_init:function(){var t=this;this._refresh(function(){t.options.playlistOptions.autoPlay?t.play(t.current):t.select(t.current)})},_initPlaylist:function(s){this.current=0,this.shuffled=!1,this.removing=!1,this.original=t.extend(!0,[],s),this._originalPlaylist()},_originalPlaylist:function(){var s=this;this.playlist=[],t.each(s.original,function(t){s.playlist[t]=s.original[t]})},_refresh:function(s){var i=this;if(s&&!t.isFunction(s))t(this.cssSelector.playlist+" ul").empty(),t.each(i.playlist,function(s){t(i.cssSelector.playlist+" ul").append(i._createListItem(i.playlist[s]))}),this._updateControls();else{var e=t(this.cssSelector.playlist+" ul").children().length?this.options.playlistOptions.displayTime:0;t(this.cssSelector.playlist+" ul").slideUp(e,function(){var e=t(this);t(this).empty(),t.each(i.playlist,function(t){e.append(i._createListItem(i.playlist[t]))}),i._updateControls(),t.isFunction(s)&&s(),i.playlist.length?t(this).slideDown(i.options.playlistOptions.displayTime):t(this).show()})}},_refreshHtmlPlaylist:function(){var s=this.current;t.each(t(this.cssSelector.playlist+" ul li"),function(i,e){parseInt(t(e).attr("name"),10)!==i&&(t(e).hasClass("jp-playlist-current")&&(s=i),t(e).attr("name",i))}),this.current=s},_createListItem:function(s){var i=' class="playlist-row ';"string"==typeof s.attrClass&&(i+=s.attrClass);var e="<li"+(i+='" ')+' name="'+t(jplaylist.cssSelector.playlist+" ul li").length+'" data-poster="'+s.poster+'" data-media_id="'+s.media_id+'" data-album_id="'+s.album_id+'" data-artist_id="'+s.artist_id+'" data-replaygain_track_gain="'+s.replaygain_track_gain+'" data-replaygain_track_peak="'+s.replaygain_track_peak+'" data-replaygain_album_gain="'+s.replaygain_album_gain+'" data-replaygain_album_peak="'+s.replaygain_album_peak+'" data-r128_track_gain="'+s.r128_track_gain+'" data-r128_album_gain="'+s.r128_album_gain+'"><div>';return e+="<a href='javascript:;' class='"+this.options.playlistOptions.removeItemClass+"'>&times;</a>",s.media_id&&(e+='<span class="jp-free-media menu"><a></a></span>'),e+="<a href='javascript:;' class='"+this.options.playlistOptions.itemClass+"' tabindex='1'>"+s.title+(s.artist?" <span class='jp-artist'>by "+s.artist+"</span>":"")+"</a>",e+="</div></li>"},_createItemHandlers:function(){var s=this;t(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.itemClass).on("click","a."+this.options.playlistOptions.itemClass,function(i){i.preventDefault();var e=t(this).parent().parent().index();s.current!==e?s.play(e):t(s.cssSelector.jPlayer).jPlayer("play"),s.blur(this)}),t(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.freeItemClass).on("click","a."+this.options.playlistOptions.freeItemClass,function(i){i.preventDefault(),t(this).parent().parent().find("."+s.options.playlistOptions.itemClass).click(),s.blur(this)}),t(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.removeItemClass).on("click","a."+this.options.playlistOptions.removeItemClass,function(i){i.preventDefault();var e=t(this).parent().parent().index();s.remove(e),s.blur(this)})},_updateControls:function(){this.options.playlistOptions.enableRemoveControls?t(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).show():t(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).hide(),this.shuffled?t(this.cssSelector.jPlayer).jPlayer("addStateClass","shuffled"):t(this.cssSelector.jPlayer).jPlayer("removeStateClass","shuffled"),t(this.cssSelector.shuffle).length&&t(this.cssSelector.shuffleOff).length&&(this.shuffled?(t(this.cssSelector.shuffleOff).show(),t(this.cssSelector.shuffle).hide()):(t(this.cssSelector.shuffleOff).hide(),t(this.cssSelector.shuffle).show()))},_highlight:function(s){t(this.cssSelector.title+" li:first").html("Playlist: "+this.name),t(this.cssSelector.title+" li:last").html(" "),this.playlist.length&&void 0!==s&&(t(this.cssSelector.playlist+" .jp-playlist-current").removeClass("jp-playlist-current"),t(this.cssSelector.playlist+" li:nth-child("+(s+1)+")").addClass("jp-playlist-current").find(".jp-playlist-item").addClass("jp-playlist-current"),t(this.cssSelector.title+" li:last").html(this.playlist[s].title+(this.playlist[s].artist?" <span class='jp-artist'>by "+this.playlist[s].artist+"</span>":"")))},setPlaylist:function(t){this._initPlaylist(t),this._init()},add:function(s,i){var e=this,l=[],a=[];t.each(e.playlist,function(t){l[t]=e.playlist[t]}),t(this.cssSelector.playlist+" ul").append(this._createListItem(s)).find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime),this._updateControls(),t.each(e.playlist,function(t){a.push(l[t])}),a.push(s),this.playlist=a,this.original=a,i?this.play(this.playlist.length-1):1===this.original.length&&this.select(0)},addAfter:function(s,i){if(!(i>=this.original.length||i<0)){var e=this,l=[],a=[];t.each(e.playlist,function(t){l[t]=e.playlist[t]}),t(this.cssSelector.playlist+" ul").find("li[name="+i+"]").after(this._createListItem(s)).end().find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime),this._updateControls(),t.each(e.playlist,function(t){a.push(l[t]),t===i&&a.push(s)}),this.playlist=a,this.original=a,1===this.original.length&&this.select(0),this._refreshHtmlPlaylist()}},remove:function(s){var i=this;if(void 0===s)return this._initPlaylist([]),this._refresh(function(){t(i.cssSelector.jPlayer).jPlayer("clearMedia")}),!0;var e=[],l=[];if(t.each(i.playlist,function(t){e[t]=i.playlist[t]}),this.removing)return!1;if(0<=(s=s<0?this.playlist.length+s:s)&&s<this.playlist.length){if(this.removing=!0,"playlist"===jplaylist.type){var a=t(t(".jp-playlist-item-remove")[s]).parent().parent().attr("track_id");jplaylist.rmTrack(a,jplaylist.name)}t(this.cssSelector.playlist+" li:nth-child("+(s+1)+")").slideUp(this.options.playlistOptions.removeTime,function(){t(this).remove(),i.original.length?s===i.current?(i.current=s<i.original.length?i.current:i.original.length-1,i.select(i.current)):s<i.current&&i.current--:(t(i.cssSelector.jPlayer).jPlayer("clearMedia"),i.current=0,i.shuffled=!1,i._updateControls()),i.removing=!1,i._refreshHtmlPlaylist()}),t.each(i.playlist,function(t){t!==s&&l.push(e[t])}),this.playlist=l,this.original=l}return!0},removeBefore:function(s){var i=this;if(void 0===s)return this._initPlaylist([]),this._refresh(function(){t(i.cssSelector.jPlayer).jPlayer("clearMedia")}),!0;var e=[],l=[];t.each(i.playlist,function(t){e[t]=i.playlist[t]});var a=0;if(0<=(s=s<0?this.playlist.length+s:s)&&s<this.playlist.length){for(this.removing=!0;a<s;){if("playlist"===jplaylist.type){var r=t(t(".jp-playlist-item-remove")[a]).parent().parent().attr("track_id");jplaylist.rmTrack(r,jplaylist.name)}t(this.cssSelector.playlist+" li:nth-child("+(a+1)+")").slideUp(this.options.playlistOptions.removeTime,function(){t(this).remove()}),a++}i.current=0,i.scan(),i._updateControls(),t.each(i.playlist,function(t){t>=s&&l.push(e[t])}),this.playlist=l,this.original=l}return!0},removeAll:function(){this.original=[],this._originalPlaylist(),t(this.cssSelector.playlist+" ul").html(" ")},rmTrack:function(s,i){i=i||"default",t.post("/playlist/rmtrack",{playlist:i,trackId:s},function(s){"error"===s[1]&&t.loadPlaylist()},"json").error(function(s){t.bootstrapMessageAuto("An error occurred while trying to remove the track from your playlist.","error")})},scan:function(){var s=this,i=this.current,e=[],l=[];t.each(s.playlist,function(t){e[t]=s.playlist[t]}),t.each(t(this.cssSelector.playlist+" ul li"),function(s,a){parseInt(t(a).attr("name"),10)!==s&&(t(a).hasClass("jp-playlist-current")&&(i=s),t(a).attr("name",s)),l.push(e[s])}),this.playlist=l,this.original=l,this.current=i},select:function(s){0<=(s=s<0?this.original.length+s:s)&&s<this.playlist.length?(this._highlight(s),t(this.cssSelector.jPlayer).jPlayer("setMedia",this.playlist[s]),startIndex=s-this.options.playlistOptions.removeCount,this.current!==s&&!this.loop&&this.options.playlistOptions.removePlayed&&startIndex>0&&this.removeBefore(startIndex),this.current=s):this.current=0},setCurrent:function(t){this.current!==t&&this.select(t)},play:function(s){void 0===s&&(s=0),s=s<0?this.original.length+s:s,"function"==typeof this.options.callbackPlay&&this.options.callbackPlay(s),0<=s&&s<this.playlist.length?this.playlist.length&&(this.select(s),t(this.cssSelector.jPlayer).jPlayer("play")):void 0===s&&t(this.cssSelector.jPlayer).jPlayer("play")},pause:function(){t(this.cssSelector.jPlayer).jPlayer("pause")},next:function(){if(this.loop)this.play(this.current);else{var t=this.current+1<this.playlist.length?this.current+1:0;t>0&&this.play(t)}},previous:function(){var t=this.current-1>=0?this.current-1:this.playlist.length-1;(this.loop||t<this.playlist.length-1)&&this.play(t)},shuffle:function(s){var i=this;void 0===s&&(s=!this.shuffled),(s||s!==this.shuffled)&&t(this.cssSelector.playlist+" ul").slideUp(this.options.playlistOptions.shuffleTime,function(){if(i.shuffled=s,s){var e=i.playlist[i.current],l=[],a=[];l.push(e),t.each(i.playlist,function(t,s){s!==e&&a.push(s)}),a.sort(function(t,s){return.5-Math.random()}),t.each(a,function(t,s){l.push(s)}),i.playlist=l,i.current=0,i.shuffled=!1,i._refresh(!0),i._highlight(0)}else i._refresh(!0),i.select(i.current);this.original=this.playlist,t(this).slideDown(i.options.playlistOptions.shuffleTime)})},blur:function(s){t(this.cssSelector.jPlayer).jPlayer("option","autoBlur")&&t(s).blur()}}}(jQuery);
